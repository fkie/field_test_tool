{"version":3,"file":"index.js","sources":["webpack:///index.js"],"sourcesContent":["!function(e){var t={};function s(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,\"a\",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p=\"assets/scripts/\",s(s.s=6)}([function(e,t,s){\"use strict\";s.d(t,\"a\",(function(){return n}));class n{static clearChildren(e){e.innerHTML=\"\"}static addOption(e,t,s=null){let n=document.createElement(\"option\");n.value=t,n.innerText=t,s&&n.classList.add(s),e.appendChild(n)}static removeFirstEmptyOption(e){\"\"===e.firstChild.value&&e.removeChild(e.firstChild)}static populateSelect(e,t,s=null){n.clearChildren(e),n.addOption(e,\"\");for(let a=0;a<t.length;a++)n.addOption(e,t[a],s&&s[a])}static addRow(e,t){const s=e.insertRow(0);for(const e of t){const t=s.insertCell(),n=document.createTextNode(e);t.appendChild(n)}}static populateTable(e,t){n.clearChildren(e);for(const s of t.reverse())n.addRow(e,s)}static addImage(e,t,s,...n){let a=document.createElement(\"img\");if(a.src=t,a.alt=s,n){if(n.length<2||n.length%2!=0)return e.appendChild(a),-1;for(let e=0;e<n.length;e+=2)a[n[e]]=n[e+1]}e.appendChild(a)}static createMaterialIcon(e){const t=document.createElement(\"i\");return t.className=\"material-icons\",t.textContent=e,t.style.alignSelf=\"center\",\"clear\"===e?t.style.color=\"red\":\"done\"===e&&(t.style.color=\"green\"),t}static createMaterialIconsContainer(e,...t){const s=document.createElement(e);return s.className=\"icon-container\",t.forEach(e=>{s.appendChild(n.createMaterialIcon(e))}),s}}},function(e,t,s){\"use strict\";s.d(t,\"a\",(function(){return n})),s.d(t,\"b\",(function(){return a}));class n{constructor(e,t,s){this.id=e,this.name=t,this.institution=s}}class a{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"name\",\"institution\"]}async get(){return(await this.serverInterface.sendGetRequest(\"personnel\")).map(e=>new n(e[0],e[1],e[2]))}async post(e,t){const s={[this.paramNames[1]]:e,[this.paramNames[2]]:t};await this.serverInterface.sendPostRequest(\"personnel\",s)}async put(e,t,s){const n={[this.paramNames[0]]:e};Object.assign(n,t&&{[this.paramNames[1]]:t},s&&{[this.paramNames[2]]:s}),await this.serverInterface.sendPutRequest(\"personnel\",n)}async delete(e){await this.serverInterface.sendDeleteRequest(\"personnel\",\"id=\"+e)}}},function(e,t,s){\"use strict\";s.d(t,\"a\",(function(){return n}));class n{constructor(){this.server_adr=location.host}async sendHttpRequest(e,t,s){const n=await fetch(t,{method:e,body:JSON.stringify(s),headers:{\"Content-Type\":\"application/json\"}});if(n.status>=200&&n.status<300)return n.json();{const e=await n.json();throw console.log(e.message),new Error(\"Something went wrong!\")}}async sendGetRequest(e,t){const s=await this.sendHttpRequest(\"GET\",`http://${this.server_adr}/${e}${t?\"?\"+t:\"\"}`);if(s)return s;throw new Error(\"Empty HTTP response!\")}async sendPostRequest(e,t){const s=await this.sendHttpRequest(\"POST\",`http://${this.server_adr}/${e}`,t);if(s)return console.log(s),s;throw new Error(\"Invalid HTTP request\")}async sendPutRequest(e,t){const s=await this.sendHttpRequest(\"PUT\",`http://${this.server_adr}/${e}`,t);if(!s)throw new Error(\"Invalid HTTP request\");console.log(s)}async sendDeleteRequest(e,t){const s=await this.sendHttpRequest(\"DELETE\",`http://${this.server_adr}/${e}${t?\"?\"+t:\"\"}`);if(!s)throw new Error(\"Invalid HTTP request\");console.log(s)}}},function(e,t,s){\"use strict\";s.d(t,\"a\",(function(){return a}));class n{constructor(e,t){this.id=e,this.institution=t}}class a{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"institution\"]}async get(){return(await this.serverInterface.sendGetRequest(\"performer\")).map(e=>new n(e[0],e[1]&&e[1].trim()))}async post(e){const t={[this.paramNames[1]]:e};await this.serverInterface.sendPostRequest(\"performer\",t)}async put(e,t){const s={[this.paramNames[0]]:e};Object.assign(s,t&&{[this.paramNames[1]]:t}),await this.serverInterface.sendPutRequest(\"performer\",s)}async delete(e){await this.serverInterface.sendDeleteRequest(\"performer\",\"id=\"+e)}}},function(e,t,s){\"use strict\";s.d(t,\"a\",(function(){return a}));class n{constructor(e,t,s,n,a,i){this.id=e,this.key=t,this.shortDescription=s,this.longDescription=n,this.institution=a,this.configuration=i}}class a{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"key\",\"short_description\",\"long_description\",\"institution\",\"configuration\"]}async get(){return(await this.serverInterface.sendGetRequest(\"vehicle\")).map(e=>new n(e[0],e[1]&&e[1].trim(),e[2]&&e[2].trim(),e[3],e[4]&&e[4].trim(),e[5]))}async post(e,t,s,n,a){const i={[this.paramNames[1]]:e,[this.paramNames[2]]:t,[this.paramNames[3]]:s,[this.paramNames[4]]:n,[this.paramNames[5]]:a};await this.serverInterface.sendPostRequest(\"vehicle\",i)}async put(e,t,s,n,a,i){const r={[this.paramNames[0]]:e};Object.assign(r,t&&{[this.paramNames[1]]:t},s&&{[this.paramNames[2]]:s},n&&{[this.paramNames[3]]:n},a&&{[this.paramNames[4]]:a},i&&{[this.paramNames[5]]:i}),await this.serverInterface.sendPutRequest(\"vehicle\",r)}async delete(e){await this.serverInterface.sendDeleteRequest(\"vehicle\",\"id=\"+e)}}},function(e,t,s){\"use strict\";s.d(t,\"a\",(function(){return a}));class n{constructor(e,t,s,n){this.id=e,this.key=t,this.shortDescription=s,this.longDescription=n}}class a{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"key\",\"short_description\",\"long_description\"]}async get(){return(await this.serverInterface.sendGetRequest(\"pose_source\")).map(e=>new n(e[0],e[1]&&e[1].trim(),e[2]&&e[2].trim(),e[3]))}async post(e,t,s){const n={[this.paramNames[1]]:e,[this.paramNames[2]]:t,[this.paramNames[3]]:s};await this.serverInterface.sendPostRequest(\"pose_source\",n)}async put(e,t,s,n){const a={[this.paramNames[0]]:e};Object.assign(a,t&&{[this.paramNames[1]]:t},s&&{[this.paramNames[2]]:s},n&&{[this.paramNames[3]]:n}),await this.serverInterface.sendPutRequest(\"pose_source\",a)}async delete(e){await this.serverInterface.sendDeleteRequest(\"pose_source\",\"id=\"+e)}}},function(e,t,s){\"use strict\";s.r(t);var n=s(2);class a{constructor(e){this.serverInterface=e,this.paramNames=[\"segment_id\",\"lat\",\"lng\",\"pose_source_id\"]}async get(e){return(await this.serverInterface.sendGetRequest(\"pose\",\"segment_id=\"+e))[0]}async post(e,t,s,n){const a={[this.paramNames[0]]:e,[this.paramNames[1]]:t,[this.paramNames[2]]:s,[this.paramNames[3]]:n};await this.serverInterface.sendPostRequest(\"pose\",a)}}class i{constructor(e){this.poseInterface=new a(e),this.mapPointsLayers=[],this.activeMarker=null,this.activePoses=null,this.leafletMap=L.map(\"mapid\"),L.tileLayer(\"https://a.tile.openstreetmap.org/{z}/{x}/{y}.png\",{attribution:'&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'}).addTo(this.leafletMap),this.mapElement=document.getElementById(\"mapid\")}removePoses(e){const t=this.mapPointsLayers.findIndex(t=>t.segmentId==e);if(t>-1){const e=this.mapPointsLayers[t].mapPosesPtr;e==this.activePoses&&(this.activePoses=null),this.leafletMap.removeLayer(e),this.mapPointsLayers.splice(t,1)}}async getAndDrawMapPoses(e){try{const t=await this.poseInterface.get(e);if(this.removePoses(e),t.features){this.mapElement.style.display=\"block\",this.leafletMap.invalidateSize(!0);let s={radius:2,weight:1,opacity:1,fillOpacity:.8};const n=L.geoJSON(t,{pointToLayer:function(e,t){return\"AUTO\"==e.properties.type?s.color=\"green\":s.color=\"red\",L.circleMarker(t,s)},onEachFeature:function(e,t){e.properties&&e.properties.segmentId&&t.bindPopup(\"<span>Segment \"+e.properties.segmentId+\"</span>\")}}).addTo(this.leafletMap);this.mapPointsLayers.push({segmentId:e,mapPosesPtr:n})}else console.log(\"No position data for segment \"+e)}catch(e){console.log(e.message)}}removeActiveMarker(){this.activeMarker&&(this.leafletMap.removeLayer(this.activeMarker),this.activeMarker=null)}removeActivePoses(){this.activePoses&&(this.activePoses.eachLayer(e=>{\"AUTO\"==e.feature.properties.type?e.setStyle({color:\"green\"}):e.setStyle({color:\"red\"})}),this.activePoses=null)}addActiveMarker(e,t){this.activeMarker=L.marker([e,t]).addTo(this.leafletMap),this.leafletMap.setView([e,t],17)}addActivePoses(e){const t=this.mapPointsLayers.find(t=>t.segmentId==e);t&&(this.activePoses=t.mapPosesPtr,this.activePoses.setStyle({color:\"blue\"}))}}var r=s(0);class l{constructor(e,t,s){this.fallbackText=t,this.closeCallbackFunction=s;const n=document.getElementById(\"modal-template\"),a=document.importNode(n.content,!0);this.modalElement=a.querySelector(\".modal\"),this.modalElement.insertBefore(e.element,this.modalElement.children[0]),e.element=this.modalElement,this.backdropElement=a.querySelector(\".backdrop\"),this.backdropElement.addEventListener(\"click\",this.hide.bind(this)),this.buttonElement=a.getElementById(\"modal-close-btn\"),this.buttonElement.addEventListener(\"click\",this.hide.bind(this))}show(){\"content\"in document.createElement(\"template\")?(document.body.insertAdjacentElement(\"afterbegin\",this.modalElement),document.body.insertAdjacentElement(\"afterbegin\",this.backdropElement),this.modalElement.scrollIntoView({behavior:\"smooth\"})):alert(this.fallbackText)}hide(){this.modalElement&&(document.body.removeChild(this.modalElement),document.body.removeChild(this.backdropElement),this.modalElement=null,this.backdropElement=null),this.closeCallbackFunction&&this.closeCallbackFunction()}}class o{constructor(e,t,s,n,a,i,r,l,o,c,d,h,m,u){this.id=e,this.legId=t,this.parentId=s,this.startTime=n,this.endTime=a,this.itoReasonId=i,this.itoReason=r,this.segmentTypeId=l,this.segmentType=o,this.obstacle=c,this.lighting=d,this.slope=h,this.lat=m,this.lng=u}}class c{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"leg_id\",\"parent_id\",\"starttime_secs\",\"endtime_secs\",\"ito_reason_id\",\"ito_reason\",\"segment_type_id\",\"segment_type\",\"obstacle\",\"lighting\",\"slope\",\"lat\",\"lng\"]}async get(e){return(await this.serverInterface.sendGetRequest(\"segment\",\"leg_id=\"+e)).map(e=>new o(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]&&e[9].trim(),e[10]&&e[10].trim(),e[11]&&e[11].trim(),e[12],e[13]))}async post(e,t,s,n,a){const i={[this.paramNames[1]]:e,[this.paramNames[5]]:t,[this.paramNames[7]]:s,[this.paramNames[12]]:n,[this.paramNames[13]]:a};await this.serverInterface.sendPostRequest(\"segment\",i)}async put(e,t,s=null,n=null,a=null,i=null){const r={[this.paramNames[0]]:e,action:t};Object.assign(r,s&&{[this.paramNames[5]]:s},n&&{[this.paramNames[9]]:n},a&&{[this.paramNames[10]]:a},i&&{[this.paramNames[11]]:i}),await this.serverInterface.sendPutRequest(\"segment\",r)}}class d{constructor(e,t){this.id=e,this.shortDescription=t}}class h{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"short_description\"]}async get(){return(await this.serverInterface.sendGetRequest(\"ito_reason\")).map(e=>new d(e[0],e[1]))}}class m{constructor(e,t,s,n,a){this.id=e,this.segmentId=t,this.secs=s,this.personnelId=n,this.note=a}}class u{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"segment_id\",\"secs\",\"personnel_id\",\"note\"]}async get(e){return(await this.serverInterface.sendGetRequest(\"note\",\"segment_id=\"+e)).map(e=>new m(e[0],e[1],e[2],e[3],e[4]))}async post(e,t,s){const n={[this.paramNames[1]]:e,[this.paramNames[3]]:t,[this.paramNames[4]]:s};await this.serverInterface.sendPostRequest(\"note\",n)}async put(e,t=null,s=null){const n={[this.paramNames[0]]:e};Object.assign(n,t&&{[this.paramNames[3]]:t},s&&{[this.paramNames[4]]:s}),await this.serverInterface.sendPutRequest(\"note\",n)}async delete(e){await this.serverInterface.sendDeleteRequest(\"note\",\"id=\"+e)}}class p{constructor(e,t,s,n,a,i){this.id=e,this.segmentId=t,this.secs=s,this.imageFilename=n,this.imageData=a,this.description=i}}class g{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"segment_id\",\"secs\",\"image_filename\",\"image_data\",\"description\"]}async get(e){return(await this.serverInterface.sendGetRequest(\"image\",\"segment_id=\"+e)).map(e=>new p(e[0],e[1],e[2],e[3]&&e[3].trim(),\"data:image/jpeg;base64, \"+atob(e[4]),e[5]&&e[5].trim()))}async post(e,t,s,n){const a={[this.paramNames[1]]:e,[this.paramNames[3]]:t,[this.paramNames[4]]:s,[this.paramNames[5]]:n};await this.serverInterface.sendPostRequest(\"image\",a)}async delete(e){await this.serverInterface.sendDeleteRequest(\"image\",\"id=\"+e)}}class f{constructor(e,t,s,n,a,i){this.segment=e,this.segmentInterface=t,this.noteInterface=s,this.imageInterface=n,this.itoReasonList=a,this.currentUser=i;const l=document.getElementById(\"edit-segment-template\");this.element=document.importNode(l.content,!0),this.element.querySelector(\"header h2 span:last-of-type\").textContent=e.id,this.element.querySelector(\"header p:first-of-type span:last-of-type\").textContent=new Date(1e3*e.startTime).toISOString(),e.endTime&&(this.element.querySelector(\"header p:last-of-type span:last-of-type\").textContent=new Date(1e3*e.endTime).toISOString());const o=this.element.getElementById(\"ito-reason\"),c=this.element.getElementById(\"obstacle\"),d=this.element.getElementById(\"lighting\"),h=this.element.getElementById(\"slope\");r.a.populateSelect(o,a.map(e=>e.shortDescription));const m=a.find(t=>t.id==e.itoReasonId);m&&(o.value=m.shortDescription,r.a.removeFirstEmptyOption(o)),c.value=e.obstacle,d.value=e.lighting,h.value=e.slope,o.addEventListener(\"change\",this.segmentDataChangedHandler.bind(this)),c.addEventListener(\"change\",this.segmentDataChangedHandler.bind(this)),d.addEventListener(\"change\",this.segmentDataChangedHandler.bind(this)),h.addEventListener(\"change\",this.segmentDataChangedHandler.bind(this)),this.element.querySelector(\"form button\").addEventListener(\"click\",this.updateDataBtnHandler.bind(this)),this.noteList=null,this.selectedNoteIdx=0,this.element.getElementById(\"note-text\").addEventListener(\"keydown\",this.noteTextChangeHandler.bind(this)),this.element.getElementById(\"save-note-btn\").addEventListener(\"click\",this.saveNoteButtonHandler.bind(this)),this.element.getElementById(\"remove-note-btn\").addEventListener(\"click\",this.removeNoteButtonHandler.bind(this));const u=this.element.querySelector(\".current-images\");this.imageList=null,this.newImage=null,this.newImageName=null,this.element.getElementById(\"current-images-tab\").addEventListener(\"click\",this.currentImagesTabClickHandler.bind(this)),this.element.getElementById(\"upload-image-tab\").addEventListener(\"click\",this.uploadImageTabClickHandler.bind(this)),u.addEventListener(\"focusin\",this.imageFocusHandler.bind(this)),u.addEventListener(\"focusout\",this.imageDefocusHandler.bind(this)),u.addEventListener(\"dblclick\",this.imageDoubleClickHandler.bind(this)),this.element.getElementById(\"new-image\").addEventListener(\"change\",this.newImageInputHandler.bind(this)),this.element.getElementById(\"submit-image-btn\").addEventListener(\"click\",this.submitImageBtnHandler.bind(this)),this.init()}async init(){await this.renderNotes(),await this.renderImages()}segmentDataChangedHandler(){this.element.querySelector(\"form button\").disabled=!1}async updateDataBtnHandler(e){e.preventDefault();const t=this.itoReasonList.find(e=>e.shortDescription==document.getElementById(\"ito-reason\").value).id,s=document.getElementById(\"obstacle\").value,n=document.getElementById(\"lighting\").value,a=document.getElementById(\"slope\").value;try{await this.segmentInterface.put(this.segment.id,\"edit\",t,s,n,a),this.element.querySelector(\"form button\").disabled=!0}catch(e){alert(e.message)}}async renderNotes(){try{this.noteList=await this.noteInterface.get(this.segment.id),r.a.clearChildren(this.element.querySelector(\".btn-tabs\")),this.noteList.forEach(e=>{this.createNewNoteTab(new Date(1e3*e.secs).toString().substring(4,10))}),this.createNewNoteTab(\"New Note\",\"\"),this.element.querySelector(\".btn-tabs\").children[this.selectedNoteIdx].click()}catch(e){alert(e.message)}}createNewNoteTab(e){const t=this.element.querySelector(\".btn-tabs\");Array.from(t.children).forEach(e=>{e.classList.remove(\"new-note\")});const s=document.createElement(\"button\");s.textContent=e,s.classList.add(\"new-note\"),t.appendChild(s),s.addEventListener(\"click\",this.noteTabClickHandler.bind(this))}noteTabClickHandler(e){const t=Array.from(this.element.querySelector(\".btn-tabs\").children);t.forEach(e=>{e.classList.remove(\"selected-tab\"),\"*\"==e.textContent.slice(-1)&&(e.textContent=e.textContent.slice(0,-1)),this.element.querySelector(\"#save-note-btn\").disabled=!0}),e.target.classList.add(\"selected-tab\"),this.selectedNoteIdx=t.indexOf(e.target);const s=this.element.querySelector(\"#note-text\");this.selectedNoteIdx<this.noteList.length?(s.value=this.noteList[this.selectedNoteIdx].note,this.element.querySelector(\"#remove-note-btn\").disabled=!1):(s.value=\"\",this.element.querySelector(\"#remove-note-btn\").disabled=!0)}noteTextChangeHandler(){let e=this.element.querySelector(\".selected-tab\");\"*\"!=e.textContent.slice(-1)&&(e.textContent+=\"*\"),document.getElementById(\"save-note-btn\").disabled=!1}async saveNoteButtonHandler(e){if(e.preventDefault(),!this.currentUser.id)return void alert(\"Please select a user to add or modify a note!\");const t=document.getElementById(\"note-text\").value;try{this.selectedNoteIdx<this.noteList.length?await this.noteInterface.put(this.noteList[this.selectedNoteIdx].id,this.currentUser.id,t):await this.noteInterface.post(this.segment.id,this.currentUser.id,t),e.target.disabled=!0,await this.renderNotes()}catch(e){alert(e.message)}}async removeNoteButtonHandler(){try{await this.noteInterface.delete(this.noteList[this.selectedNoteIdx].id),await this.renderNotes()}catch(e){alert(e.message)}}async renderImages(){try{this.imageList=await this.imageInterface.get(this.segment.parentId);const e=this.element.querySelector(\".current-images\");r.a.clearChildren(e),this.imageList.forEach(t=>{const s=document.createElement(\"div\");s.tabIndex=0,r.a.addImage(s,t.imageData,t.imageFilename),e.appendChild(s)})}catch(e){alert(e.message)}}async currentImagesTabClickHandler(e){e.target.classList.contains(\"selected-tab\")||(e.target.nextElementSibling.classList.remove(\"selected-tab\"),e.target.classList.add(\"selected-tab\"),this.element.querySelector(\".upload-image\").style.display=\"none\",this.element.querySelector(\".current-images\").style.display=\"\",this.renderImages())}uploadImageTabClickHandler(e){e.target.classList.contains(\"selected-tab\")||(this.currentUser.id?(e.target.previousElementSibling.classList.remove(\"selected-tab\"),e.target.classList.add(\"selected-tab\"),this.element.querySelector(\".current-images\").style.display=\"none\",this.element.querySelector(\".upload-image\").style.display=\"block\"):alert(\"Please select a user to add an image!\"))}async removeImageBtnClickHandler(e){const t=Array.from(this.element.querySelector(\".current-images\").children).indexOf(e.target.closest(\"div\"));try{await this.imageInterface.delete(this.imageList[t].id),this.renderImages()}catch(e){alert(e.message)}}imageFocusHandler(e){const t=r.a.createMaterialIconsContainer(\"span\",\"remove_circle_outline\");t.addEventListener(\"click\",this.removeImageBtnClickHandler.bind(this)),e.target.appendChild(t)}imageDefocusHandler(e){e.target.lastElementChild.remove()}imageDoubleClickHandler(e){if(\"img\"===e.target.tagName.toLowerCase()){const t=open(\"\");t.document.write(e.target.outerHTML),t.document.head.appendChild(document.head.querySelector(\"meta\")),t.document.head.appendChild(document.createElement(\"title\")),t.document.head.querySelector(\"title\").textContent=e.target.alt}}newImageInputHandler(e){const t=e.target.files[0];if(this.newImageName=t.name.replace(/[.][^.]+$/,\"\"),t){const e=new FileReader;e.readAsDataURL(t),e.addEventListener(\"load\",e=>{this.newImage=e.target.result,this.newImage=this.newImage.substring(this.newImage.indexOf(\",\")+1)}),document.getElementById(\"submit-image-btn\").disabled=!1}}async submitImageBtnHandler(e){if(e.preventDefault(),this.newImage)try{await this.imageInterface.post(this.segment.parentId,this.newImageName,this.newImage,\"Image uploaded by \"+this.currentUser.name),this.newImage=null,e.target.disabled=!0,document.getElementById(\"current-images-tab\").click()}catch(e){alert(e.message)}}}class v{constructor(e,t){this.serverInterface=e,this.currentUser=t,this.getSegmentsBtn=document.getElementById(\"get-segments-btn\"),this.legSelectHook=document.getElementById(\"leg-id\"),this.unexpectedBtn=document.getElementById(\"unexpected-btn\"),this.plannerBtn=document.getElementById(\"planner-btn\"),this.safetyBtn=document.getElementById(\"safety-btn\"),this.transitBtn=document.getElementById(\"transit-btn\"),this.autoRefreshBox=document.getElementById(\"auto-refresh\"),this.segmentTable=document.getElementById(\"segment-table-body\"),this.segmentNewBtn=document.getElementById(\"new-segment-btn\"),this.segmentEndBtn=document.getElementById(\"end-segment-btn\"),this.segmentEditBtn=document.getElementById(\"edit-segment-btn\"),this.refreshBtn=document.getElementById(\"refresh-btn\"),this.mapInterface=new i(e),this.segmentInterface=new c(e),this.itoReasonInterface=new h(e),this.noteInterface=new u(e),this.imageInterface=new g(e),this.segmentList=[],this.itoReasonList=null,this.autoRefreshIntervalId=null,this.selectedRow=null,this.selectedRowId=null,this.selectedRowParentId=null,this.getSegmentsBtn.addEventListener(\"click\",this.updateSegments.bind(this)),this.segmentTable.addEventListener(\"click\",this.segmentTableClickHandler.bind(this)),this.unexpectedBtn.addEventListener(\"click\",this.quickReasonEditBtnHandler.bind(this,12)),this.plannerBtn.addEventListener(\"click\",this.quickReasonEditBtnHandler.bind(this,3)),this.safetyBtn.addEventListener(\"click\",this.quickReasonEditBtnHandler.bind(this,1)),this.transitBtn.addEventListener(\"click\",this.quickReasonEditBtnHandler.bind(this,9)),this.segmentNewBtn.addEventListener(\"click\",this.newSegmentHandler.bind(this)),this.segmentEndBtn.addEventListener(\"click\",this.endSegmentHandler.bind(this)),this.segmentEditBtn.addEventListener(\"click\",this.editSegmentHandler.bind(this)),this.refreshBtn.addEventListener(\"click\",this.updateSegments.bind(this)),this.autoRefreshBox.addEventListener(\"change\",this.autoRefreshBoxHandler.bind(this))}async updateSegments(){try{this.segmentList=await this.segmentInterface.get(this.legSelectHook.value);const e=Array.from(this.segmentTable.querySelectorAll(\"tr\"));for(const t of e.reverse()){this.segmentList.find(e=>e.id==t.firstChild.textContent)||(this.selectedRowId==t.firstChild.textContent&&(this.selectedRow=null,this.selectedRowId=null,this.selectedRowParentId=null,this.mapInterface.removeActiveMarker(),this.mapInterface.removeActivePoses()),t.remove())}const t=this.mapInterface.mapPointsLayers;for(let e=t.length-1;e>=0;e--){this.segmentList.find(s=>s.id==t[e].segmentId)||(this.mapInterface.leafletMap.removeLayer(t[e].mapPosesPtr),t.splice(e,1))}if(0==t.length){const e=this.segmentList.find(e=>e.lat&&e.lng);e&&(console.log(\"Setting map display in \"+e.lat+\", \"+e.lng),this.mapInterface.leafletMap.setView([e.lat,e.lng],17))}for(const s of this.segmentList.reverse()){if(\"ITO\"==s.segmentType&&s.parentId){const t=e.find(e=>e.firstChild.textContent==s.id),n=null==s.endTime?\"OPEN\":\"CLOSED\";t?(t.children[2].textContent!=s.itoReason&&(console.log(\"Updating row \"+s.id+\" reason\"),t.children[2].textContent=s.itoReason),t.children[3].textContent!=n&&(console.log(\"Updating row \"+s.id+\" state\"),t.children[3].textContent=n)):(console.log(\"Creating row \"+s.id),r.a.addRow(this.segmentTable,[s.id,s.segmentType,s.itoReason,n]))}if(!s.parentId){t.find(e=>e.segmentId==s.id)&&null!=s.endTime||(await this.mapInterface.getAndDrawMapPoses(s.id),s.id==this.selectedRowParentId&&this.mapInterface.addActivePoses(s.id))}}document.getElementById(\"segment-detail\").style.display=\"block\",this.mapInterface.mapElement.style.display=\"block\"}catch(e){alert(e.message)}}autoRefreshBoxHandler(){this.autoRefreshBox.checked?this.legSelectHook.value?this.autoRefreshIntervalId=setInterval(this.updateSegments.bind(this),2e3):(this.autoRefreshBox.checked=!1,alert(\"No leg selected!\")):clearInterval(this.autoRefreshIntervalId)}segmentTableClickHandler(e){const t=e.target.closest(\"tr\");if(this.selectedRow&&(this.selectedRow.classList.remove(\"active-row\"),this.mapInterface.removeActiveMarker(),this.mapInterface.removeActivePoses(),this.selectedRow==t))return this.selectedRow=null,this.selectedRowId=null,void(this.selectedRowParentId=null);this.selectedRow=t,this.selectedRowId=t.firstChild.textContent,this.selectedRow.classList.add(\"active-row\");const s=this.segmentList.find(e=>e.id==this.selectedRowId);if(this.selectedRowParentId=s.parentId,s.lat&&s.lng)this.mapInterface.addActiveMarker(s.lat,s.lng);else{const e=this.segmentList.find(e=>e.id==s.parentId);e.lat&&e.lng&&this.mapInterface.addActiveMarker(e.lat,e.lng)}this.mapInterface.addActivePoses(this.selectedRowParentId)}async quickReasonEditBtnHandler(e){if(this.selectedRowId)try{await this.segmentInterface.put(this.selectedRowId,\"edit\",e),this.updateSegments()}catch(e){alert(e.message)}else alert(\"No segment selected for edition!\")}async newSegmentHandler(){try{await this.segmentInterface.post(this.legSelectHook.value,11,1,null,null),this.updateSegments()}catch(e){alert(e.message)}}async endSegmentHandler(){if(this.selectedRowId)try{await this.segmentInterface.put(this.selectedRowId,\"close\"),this.updateSegments()}catch(e){alert(e.message)}else alert(\"No segment selected to end!\")}async editSegmentHandler(){if(this.selectedRowId)try{this.itoReasonList||(this.itoReasonList=await this.itoReasonInterface.get());const e=this.segmentList.find(e=>e.id==this.selectedRowId),t=new f(e,this.segmentInterface,this.noteInterface,this.imageInterface,this.itoReasonList,this.currentUser);new l(t,\"Your browser does't support this feature! - Please change to a more modern one.\",this.updateSegments.bind(this)).show()}catch(e){alert(e.messaje)}else alert(\"Please select a segment to edit.\")}}class y{constructor(e,t,s,n,a,i,r){this.id=e,this.startTime=t,this.endTime=s,this.location=n,this.version=a,this.timeZone=i,this.note=r}}class I{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"starttime_secs\",\"endtime_secs\",\"location\",\"version\",\"time_zone\",\"note\"]}async get(){return(await this.serverInterface.sendGetRequest(\"test_event\")).map(e=>new y(e[0],e[1],e[2],e[3]&&e[3].trim(),e[4]&&e[4].trim(),e[5]&&e[5].trim(),e[6]))}async post(e,t,s,n){const a={[this.paramNames[3]]:e,[this.paramNames[4]]:t,[this.paramNames[5]]:s,[this.paramNames[6]]:n};await this.serverInterface.sendPostRequest(\"test_event\",a)}async put(e,t,s=null,n=null,a=null,i=null){const r={[this.paramNames[0]]:e,action:t};Object.assign(r,s&&{[this.paramNames[3]]:s},n&&{[this.paramNames[4]]:n},a&&{[this.paramNames[5]]:a},i&&{[this.paramNames[6]]:i}),await this.serverInterface.sendPutRequest(\"test_event\",r)}}class b{constructor(e,t,s,n,a,i,r,l,o,c,d,h,m,u){this.id=e,this.testEventId=t,this.startTime=s,this.endTime=n,this.testAdministratorId=a,this.testDirectorId=i,this.safetyOfficerId=r,this.robotOperatorId=l,this.performerId=o,this.testIntent=c,this.workspace=d,this.vehicleId=h,this.note=m,this.number=u}}class w{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"test_event_id\",\"starttime_secs\",\"endtime_secs\",\"test_administrator_id\",\"test_director_id\",\"safety_officer_id\",\"robot_operator_id\",\"performer_id\",\"test_intent\",\"workspace\",\"vehicle_id\",\"note\",\"number\"]}async get(e){return(await this.serverInterface.sendGetRequest(\"shift\",\"test_event_id=\"+e)).map(e=>new b(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]&&e[9].trim(),e[10]&&e[10].trim(),e[11],e[12],e[13]))}async post(e,t,s,n,a,i,r,l,o,c){const d={[this.paramNames[1]]:e,[this.paramNames[4]]:t,[this.paramNames[5]]:s,[this.paramNames[6]]:n,[this.paramNames[7]]:a,[this.paramNames[8]]:i,[this.paramNames[9]]:r,[this.paramNames[10]]:l,[this.paramNames[11]]:o,[this.paramNames[12]]:c};await this.serverInterface.sendPostRequest(\"shift\",d)}async put(e,t,s=null,n=null,a=null,i=null,r=null,l=null,o=null,c=null,d=null){const h={[this.paramNames[0]]:e,action:t};Object.assign(h,s&&{[this.paramNames[4]]:s},n&&{[this.paramNames[5]]:n},a&&{[this.paramNames[6]]:a},i&&{[this.paramNames[7]]:i},r&&{[this.paramNames[8]]:r},l&&{[this.paramNames[9]]:l},o&&{[this.paramNames[10]]:o},c&&{[this.paramNames[11]]:c},d&&{[this.paramNames[12]]:d}),await this.serverInterface.sendPutRequest(\"shift\",h)}}class E{constructor(e,t,s,n,a,i,r,l){this.id=e,this.shiftId=t,this.startTime=s,this.endTime=n,this.weatherId=a,this.defaultPoseSourceId=i,this.note=r,this.number=l}}class C{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"shift_id\",\"starttime_secs\",\"endtime_secs\",\"weather_id\",\"default_pose_source_id\",\"note\",\"number\"]}async get(e){return(await this.serverInterface.sendGetRequest(\"leg\",\"shift_id=\"+e)).map(e=>new E(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]))}async post(e,t,s,n){const a={[this.paramNames[1]]:e,[this.paramNames[4]]:t,[this.paramNames[5]]:s,[this.paramNames[6]]:n};await this.serverInterface.sendPostRequest(\"leg\",a)}async put(e,t,s=null,n=null,a=null){const i={[this.paramNames[0]]:e,action:t};Object.assign(i,s&&{[this.paramNames[4]]:s},n&&{[this.paramNames[5]]:n},a&&{[this.paramNames[6]]:a}),await this.serverInterface.sendPutRequest(\"leg\",i)}}var B=s(3),S=s(1),N=s(4);class k{constructor(e,t){this.id=e,this.shortDescription=t}}class H{constructor(e){this.serverInterface=e,this.paramNames=[\"id\",\"short_description\"]}async get(){return(await this.serverInterface.sendGetRequest(\"weather\")).map(e=>new k(e[0],e[1]&&e[1].trim()))}}var R=s(5);const T=[{label:\"(UTC-12:00)\",value:\"-12\"},{label:\"(UTC-11:00)\",value:\"-11\"},{label:\"(UTC-10:00)\",value:\"-10\"},{label:\"(UTC-09:00)\",value:\"-9\"},{label:\"(UTC-08:00)\",value:\"-8\"},{label:\"(UTC-07:00)\",value:\"-7\"},{label:\"(UTC-06:00)\",value:\"-6\"},{label:\"(UTC-05:00)\",value:\"-5\"},{label:\"(UTC-04:00)\",value:\"-4\"},{label:\"(UTC-03:30)\",value:\"-3.5\"},{label:\"(UTC-03:00)\",value:\"-3\"},{label:\"(UTC-02:00)\",value:\"-2\"},{label:\"(UTC-01:00)\",value:\"-1\"},{label:\"(UTC+00:00)\",value:\"0\"},{label:\"(UTC+01:00)\",value:\"1\"},{label:\"(UTC+02:00)\",value:\"2\"},{label:\"(UTC+03:00)\",value:\"3\"},{label:\"(UTC+03:30)\",value:\"3.5\"},{label:\"(UTC+04:00)\",value:\"4\"},{label:\"(UTC+04:30)\",value:\"4.5\"},{label:\"(UTC+05:00)\",value:\"5\"},{label:\"(UTC+05:30)\",value:\"5.5\"},{label:\"(UTC+05:45)\",value:\"5.75\"},{label:\"(UTC+06:00)\",value:\"6\"},{label:\"(UTC+06:30)\",value:\"6.5\"},{label:\"(UTC+07:00)\",value:\"7\"},{label:\"(UTC+08:00)\",value:\"8\"},{label:\"(UTC+09:00)\",value:\"9\"},{label:\"(UTC+09:30)\",value:\"9.5\"},{label:\"(UTC+10:00)\",value:\"10\"},{label:\"(UTC+11:00)\",value:\"11\"},{label:\"(UTC+12:00)\",value:\"12\"},{label:\"(UTC+13:00)\",value:\"13\"}];class D{constructor(e,t){this.testEvent=e,this.testEventInterface=t;const s=document.getElementById(\"edit-test-event-template\");this.element=document.importNode(s.content,!0),this.element.querySelector(\"header h2 span:last-of-type\").textContent=e.id,this.element.querySelector(\"header p:first-of-type span:last-of-type\").textContent=new Date(1e3*e.startTime).toISOString(),e.endTime&&(this.element.querySelector(\"header p:last-of-type span:last-of-type\").textContent=new Date(1e3*e.endTime).toISOString());const n=this.element.getElementById(\"location\"),a=this.element.getElementById(\"version\"),i=this.element.getElementById(\"time-zone\"),l=this.element.getElementById(\"test-event-note\"),o=T.map(e=>e.label);r.a.populateSelect(i,o);const c=o.findIndex(t=>t==e.timeZone);c>-1&&(i.value=o[c],r.a.removeFirstEmptyOption(i)),n.value=e.location,a.value=e.version,l.value=e.note,n.addEventListener(\"change\",this.testEventDataChangedHandler.bind(this)),a.addEventListener(\"change\",this.testEventDataChangedHandler.bind(this)),i.addEventListener(\"change\",this.testEventDataChangedHandler.bind(this)),l.addEventListener(\"change\",this.testEventDataChangedHandler.bind(this)),this.element.querySelector(\"form button\").addEventListener(\"click\",this.updateDataBtnHandler.bind(this))}testEventDataChangedHandler(){this.element.querySelector(\"form button\").disabled=!1}async updateDataBtnHandler(e){e.preventDefault();const t=document.getElementById(\"location\").value,s=document.getElementById(\"version\").value,n=document.getElementById(\"time-zone\").value,a=document.getElementById(\"test-event-note\").value;try{await this.testEventInterface.put(this.testEvent.id,\"edit\",t,s,n,a),this.element.querySelector(\"form button\").disabled=!0}catch(e){alert(e.message)}}}class q{constructor(e,t,s,n,a){this.shift=e,this.shiftInterface=t,this.performerList=s,this.personnelList=n,this.vehicleList=a;const i=document.getElementById(\"edit-shift-template\");this.element=document.importNode(i.content,!0),this.element.querySelector(\"header h2 span:last-of-type\").textContent=e.id,this.element.querySelector(\"header p:first-of-type span:last-of-type\").textContent=new Date(1e3*e.startTime).toISOString(),e.endTime&&(this.element.querySelector(\"header p:last-of-type span:last-of-type\").textContent=new Date(1e3*e.endTime).toISOString());const l=this.element.getElementById(\"performer\"),o=this.element.getElementById(\"test-director\"),c=this.element.getElementById(\"test-admin\"),d=this.element.getElementById(\"robot-operator\"),h=this.element.getElementById(\"safety-officer\"),m=this.element.getElementById(\"test-intent\"),u=this.element.getElementById(\"workspace\"),p=this.element.getElementById(\"vehicle\"),g=this.element.getElementById(\"shift-note\");r.a.populateSelect(l,s.map(e=>e.institution)),r.a.populateSelect(o,n.map(e=>e.name)),r.a.populateSelect(c,n.map(e=>e.name)),r.a.populateSelect(d,n.map(e=>e.name)),r.a.populateSelect(h,n.map(e=>e.name)),r.a.populateSelect(p,a.map(e=>e.shortDescription));const f=s.find(t=>t.id==e.performerId);f&&(l.value=f.institution,r.a.removeFirstEmptyOption(l));const v=n.find(t=>t.id==e.testDirectorId);v&&(o.value=v.name,r.a.removeFirstEmptyOption(o));const y=n.find(t=>t.id==e.testAdministratorId);y&&(c.value=y.name,r.a.removeFirstEmptyOption(c));const I=n.find(t=>t.id==e.robotOperatorId);I&&(d.value=I.name,r.a.removeFirstEmptyOption(d));const b=n.find(t=>t.id==e.safetyOfficerId);b&&(h.value=b.name,r.a.removeFirstEmptyOption(h));const w=a.find(t=>t.id==e.vehicleId);w&&(p.value=w.shortDescription,r.a.removeFirstEmptyOption(p)),m.value=e.testIntent,u.value=e.workspace,g.value=e.note,l.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),o.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),c.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),d.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),h.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),m.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),u.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),p.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),g.addEventListener(\"change\",this.shiftDataChangedHandler.bind(this)),this.element.querySelector(\"form button\").addEventListener(\"click\",this.updateDataBtnHandler.bind(this))}shiftDataChangedHandler(){this.element.querySelector(\"form button\").disabled=!1}async updateDataBtnHandler(e){e.preventDefault();const t=this.personnelList.find(e=>e.name==document.getElementById(\"test-admin\").value).id,s=this.personnelList.find(e=>e.name==document.getElementById(\"test-director\").value).id,n=this.personnelList.find(e=>e.name==document.getElementById(\"safety-officer\").value).id,a=this.personnelList.find(e=>e.name==document.getElementById(\"robot-operator\").value).id,i=this.performerList.find(e=>e.institution==document.getElementById(\"performer\").value).id,r=document.getElementById(\"test-intent\").value,l=document.getElementById(\"workspace\").value,o=this.vehicleList.find(e=>e.shortDescription==document.getElementById(\"vehicle\").value).id,c=document.getElementById(\"shift-note\").value;try{await this.shiftInterface.put(this.shift.id,\"edit\",t,s,n,a,i,r,l,o,c),this.element.querySelector(\"form button\").disabled=!0}catch(e){alert(e.message)}}}class P{constructor(e,t,s,n){this.leg=e,this.legInterface=t,this.weatherList=s,this.poseSourceList=n;const a=document.getElementById(\"edit-leg-template\");this.element=document.importNode(a.content,!0),this.element.querySelector(\"header h2 span:last-of-type\").textContent=e.id,this.element.querySelector(\"header p:first-of-type span:last-of-type\").textContent=new Date(1e3*e.startTime).toISOString(),e.endTime&&(this.element.querySelector(\"header p:last-of-type span:last-of-type\").textContent=new Date(1e3*e.endTime).toISOString());const i=this.element.getElementById(\"weather\"),l=this.element.getElementById(\"default-pose-source\"),o=this.element.getElementById(\"leg-note\");r.a.populateSelect(i,s.map(e=>e.shortDescription)),r.a.populateSelect(l,n.map(e=>e.shortDescription));const c=s.find(t=>t.id==e.weatherId);c&&(i.value=c.shortDescription,r.a.removeFirstEmptyOption(i));const d=n.find(t=>t.id==e.defaultPoseSourceId);d&&(l.value=d.shortDescription,r.a.removeFirstEmptyOption(l)),o.value=e.note,i.addEventListener(\"change\",this.legDataChangedHandler.bind(this)),l.addEventListener(\"change\",this.legDataChangedHandler.bind(this)),o.addEventListener(\"change\",this.legDataChangedHandler.bind(this)),this.element.querySelector(\"form button\").addEventListener(\"click\",this.updateDataBtnHandler.bind(this))}legDataChangedHandler(){this.element.querySelector(\"form button\").disabled=!1}async updateDataBtnHandler(e){e.preventDefault();const t=this.weatherList.find(e=>e.shortDescription==document.getElementById(\"weather\").value).id,s=this.poseSourceList.find(e=>e.shortDescription==document.getElementById(\"default-pose-source\").value).id,n=document.getElementById(\"leg-note\").value;try{await this.legInterface.put(this.leg.id,\"edit\",t,s,n),this.element.querySelector(\"form button\").disabled=!0}catch(e){alert(e.message)}}}class _{constructor(e,t,s=null,n=null,a){this.name=e,this.dataInterface=t,this.parentSelect=s,this.childClass=n,this.checkSelectionCallback=a,this.select=document.getElementById(e+\"-id\"),this.newBtn=document.getElementById(`new-${e}-btn`),this.endBtn=document.getElementById(`end-${e}-btn`),this.editBtn=document.getElementById(`edit-${e}-btn`),this.postData=null,this.dataList=[],this.select.addEventListener(\"change\",this.selectChangeHandler.bind(this)),this.newBtn.addEventListener(\"click\",this.newBtnClickHandler.bind(this)),this.endBtn.addEventListener(\"click\",this.endBtnClickHandler.bind(this)),this.editBtn.addEventListener(\"click\",this.editBtnClickHandler.bind(this))}clearSelectData(){this.childClass&&this.childClass.clearSelectData(),r.a.clearChildren(this.select)}async updateData(){this.dataList=await this.dataInterface.get(this.parentSelect&&this.parentSelect.value)}async updateSelect(){if(!this.parentSelect||this.parentSelect.value)try{await this.updateData(),r.a.populateSelect(this.select,this.dataList.map(e=>e.id),this.dataList.map(e=>e.endTime?\"closed-log\":\"open-log\")),this.childClass&&this.childClass.clearSelectData()}catch(e){alert(e.message)}else alert(\"Please select an ID in the parent select first.\")}async selectChangeHandler(){r.a.removeFirstEmptyOption(this.select),this.childClass&&await this.childClass.updateSelect(),this.checkSelectionCallback()}async newBtnClickHandler(){try{await this.dataInterface.post(...this.postData),await this.updateSelect(),r.a.removeFirstEmptyOption(this.select),this.select.value=Math.max(...this.dataList.map(e=>e.id)),await this.editBtnClickHandler(),this.checkSelectionCallback()}catch(e){alert(e.message)}}async recursiveUpdate(){this.childClass&&await this.childClass.recursiveUpdate(),(!this.parentSelect||this.parentSelect&&this.parentSelect.value)&&(await this.updateData(),Array.from(this.select.children).forEach(e=>{if(e.value){this.dataList.find(t=>t.id==e.value).endTime&&(e.className=\"closed-log\")}}))}async endBtnClickHandler(){if(this.select.value)try{await this.dataInterface.put(this.select.value,\"close\"),await this.recursiveUpdate(),this.checkSelectionCallback()}catch(e){alert(e.message)}else alert(\"Please select an ID to close.\")}async editBtnClickHandler(){new l(this.editContainer,\"Your browser does't support this feature! - Please change to a more modern one.\",this.updateData.bind(this)).show()}}class x extends _{constructor(e,t,s){super(\"test-event\",new I(e),null,t,s)}async newBtnClickHandler(){this.postData=[null,null,null,null],await super.newBtnClickHandler()}async editBtnClickHandler(){if(!this.select.value)return void alert(\"Please select an ID to edit.\");const e=this.dataList.find(e=>e.id==this.select.value);this.editContainer=new D(e,this.dataInterface),await super.editBtnClickHandler()}}class U extends _{constructor(e,t,s,n){super(\"shift\",new w(e),document.getElementById(\"test-event-id\"),t,s),this.currentUser=n,this.performerInterface=new B.a(e),this.personnelInterface=new S.b(e),this.vehicleInterface=new N.a(e),this.performerList=null,this.personnelList=null,this.vehicleList=null}async newBtnClickHandler(){if(!this.currentUser.id)return void alert(\"Please select a user to add a new shift!\");if(!this.performerList)try{this.performerList=await this.performerInterface.get()}catch(e){return void alert(e.message)}const e=this.performerList.find(e=>e.institution==this.currentUser.institution);this.postData=[this.parentSelect.value,this.currentUser.id,this.currentUser.id,this.currentUser.id,this.currentUser.id,e.id,null,null,1,null],await super.newBtnClickHandler()}async editBtnClickHandler(){if(!this.select.value)return void alert(\"Please select an ID to edit.\");const e=this.dataList.find(e=>e.id==this.select.value);try{this.performerList||(this.performerList=await this.performerInterface.get()),this.personnelList||(this.personnelList=await this.personnelInterface.get()),this.vehicleList||(this.vehicleList=await this.vehicleInterface.get())}catch(e){return void alert(e.message)}this.editContainer=new q(e,this.dataInterface,this.performerList,this.personnelList,this.vehicleList),await super.editBtnClickHandler()}}class O extends _{constructor(e,t){super(\"leg\",new C(e),document.getElementById(\"shift-id\"),null,t),this.weatherInterface=new H(e),this.poseSourceInterface=new R.a(e),this.weatherList=null,this.poseSourceList=null}async newBtnClickHandler(){this.postData=[this.parentSelect.value,1,1,null],await super.newBtnClickHandler()}async editBtnClickHandler(){if(!this.select.value)return void alert(\"Please select an ID to edit.\");const e=this.dataList.find(e=>e.id==this.select.value);try{this.weatherList||(this.weatherList=await this.weatherInterface.get()),this.poseSourceList||(this.poseSourceList=await this.poseSourceInterface.get())}catch(e){return void alert(e.message)}this.editContainer=new P(e,this.dataInterface,this.weatherList,this.poseSourceList),await super.editBtnClickHandler()}}class M{constructor(e,t){this.legLog=new O(e,this.checkSelectedLogs.bind(this)),this.shiftLog=new U(e,this.legLog,this.checkSelectedLogs.bind(this),t),this.testEventLog=new x(e,this.shiftLog,this.checkSelectedLogs.bind(this)),this.init()}async init(){this.testEventLog.updateSelect()}checkSelectedLogs(){document.querySelector(\"#segment-detail\").style.display=\"none\",document.getElementById(\"mapid\").style.display=\"none\";const e=document.getElementById(\"get-segments-btn\");this.testEventLog.select.value&&this.shiftLog.select.value&&this.legLog.select.value?e.disabled=!1:e.disabled=!0;const t=document.getElementById(\"auto-refresh\");t.checked&&t.click()}}class A{constructor(e,t){this.currentUser=e,this.personnelList=t;const s=document.getElementById(\"select-user-template\");this.element=document.importNode(s.content,!0);const n=this.element.getElementById(\"user\");r.a.populateSelect(n,t.map(e=>`${e.id}.- ${e.name} - ${e.institution}`));const a=t.findIndex(t=>t.id==e.id);a>-1&&(n.value=n.children[a].value,r.a.removeFirstEmptyOption(n)),n.addEventListener(\"change\",this.userChangedHandler.bind(this))}userChangedHandler(){const e=document.getElementById(\"user\").value;Object.assign(this.currentUser,this.personnelList.find(t=>e.includes(t.name)))}}class j{constructor(e){this.serverInterface=e,this.userIcon=document.getElementById(\"user-icon\"),this.userName=document.getElementById(\"user-name\"),this.currentUser=new S.a,this.personnelInterface=new S.b(this.serverInterface),this.segmentDetail=new v(e,this.currentUser),this.trailSelection=new M(e,this.currentUser),this.userIcon.addEventListener(\"click\",this.userIconClickHandler.bind(this))}async userIconClickHandler(){try{const e=await this.personnelInterface.get(),t=new A(this.currentUser,e);new l(t,\"Your browser does't support this feature! - Please change to a more modern one.\",()=>{this.userName.textContent=this.currentUser.name||\"Select User\"}).show()}catch(e){alert(e.message)}}}(class{static init(){this.serverInterface=new n.a,this.mainFrame=new j(this.serverInterface)}}).init()}]);"],"mappings":"AAAA","sourceRoot":""}