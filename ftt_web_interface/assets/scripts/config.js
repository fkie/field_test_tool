!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="assets/scripts/",s(s.s=9)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{static clearChildren(e){e.innerHTML=""}static addOption(e,t,s=null){let n=document.createElement("option");n.value=t,n.innerText=t,s&&n.classList.add(s),e.appendChild(n)}static removeFirstEmptyOption(e){""===e.firstChild.value&&e.removeChild(e.firstChild)}static populateSelect(e,t,s=null){n.clearChildren(e),n.addOption(e,"");for(let r=0;r<t.length;r++)n.addOption(e,t[r],s&&s[r])}static addRow(e,t){const s=e.insertRow(0);for(const e of t){const t=s.insertCell(),n=document.createTextNode(e);t.appendChild(n)}}static populateTable(e,t){n.clearChildren(e);for(const s of t.reverse())n.addRow(e,s)}static addImage(e,t,s,...n){let r=document.createElement("img");if(r.src=t,r.alt=s,n){if(n.length<2||n.length%2!=0)return e.appendChild(r),-1;for(let e=0;e<n.length;e+=2)r[n[e]]=n[e+1]}e.appendChild(r)}static createMaterialIcon(e){const t=document.createElement("i");return t.className="material-icons",t.textContent=e,t.style.alignSelf="center","clear"===e?t.style.color="red":"done"===e&&(t.style.color="green"),t}static createMaterialIconsContainer(e,t,s=null){const r=document.createElement(e);return r.className="icon-container",t.forEach((e,t)=>{const a=n.createMaterialIcon(e);s&&"function"==typeof s[t]&&a.addEventListener("click",s[t]),r.appendChild(a)}),r}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(e,t,s){this.fallbackText=t,this.closeCallbackFunction=s,this.visible=!1;const n=document.getElementById("modal-template"),r=document.importNode(n.content,!0);this.modalElement=r.querySelector(".modal"),this.modalElement.insertBefore(e.element,this.modalElement.children[0]),e.element=this.modalElement,this.modalElement.addEventListener("transitionend",this.close.bind(this)),this.backdropElement=r.querySelector(".backdrop"),this.backdropElement.addEventListener("click",this.hide.bind(this)),this.buttonElement=r.getElementById("modal-close-btn"),this.buttonElement.addEventListener("click",this.hide.bind(this))}show(){"content"in document.createElement("template")?(document.body.insertAdjacentElement("afterbegin",this.modalElement),document.body.insertAdjacentElement("afterbegin",this.backdropElement),this.modalElement.scrollIntoView({behavior:"smooth"}),this.visible=!0,this.modalElement.classList.add("show")):alert(this.fallbackText)}hide(){this.visible=!1,this.modalElement.classList.remove("show")}close(){this.visible||(this.modalElement&&(document.body.removeChild(this.modalElement),document.body.removeChild(this.backdropElement),this.modalElement=null,this.backdropElement=null),this.closeCallbackFunction&&this.closeCallbackFunction())}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return r}));class n{constructor(e,t,s){this.id=e,this.name=t,this.institution=s}}class r{constructor(e){this.serverInterface=e,this.paramNames=["id","name","institution"]}async get(){return(await this.serverInterface.sendGetRequest("personnel")).map(e=>new n(e[0],e[1],e[2]))}async post(e,t){const s={[this.paramNames[1]]:e,[this.paramNames[2]]:t};await this.serverInterface.sendPostRequest("personnel",s)}async put(e,t,s){const n={[this.paramNames[0]]:e};Object.assign(n,null!==t&&{[this.paramNames[1]]:t},null!==s&&{[this.paramNames[2]]:s}),await this.serverInterface.sendPutRequest("personnel",n)}async delete(e){await this.serverInterface.sendDeleteRequest("personnel","id="+e)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(){this.server_adr=location.host}async sendHttpRequest(e,t,s){const n=await fetch(t,{method:e,body:JSON.stringify(s),headers:{"Content-Type":"application/json"}});if(n.status>=200&&n.status<300)return n.json();{const e=await n.json();throw console.log(e.message),new Error("Something went wrong! Server message: "+e.message)}}async sendGetRequest(e,t){const s=await this.sendHttpRequest("GET",`http://${this.server_adr}/${e}${t?"?"+t:""}`);if(s)return s;throw new Error("Empty HTTP response!")}async sendPostRequest(e,t){const s=await this.sendHttpRequest("POST",`http://${this.server_adr}/${e}`,t);if(s)return console.log(s),s;throw new Error("Invalid HTTP request")}async sendPutRequest(e,t){const s=await this.sendHttpRequest("PUT",`http://${this.server_adr}/${e}`,t);if(!s)throw new Error("Invalid HTTP request");console.log(s)}async sendDeleteRequest(e,t){const s=await this.sendHttpRequest("DELETE",`http://${this.server_adr}/${e}${t?"?"+t:""}`);if(!s)throw new Error("Invalid HTTP request");console.log(s)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class n{constructor(e,t){this.id=e,this.institution=t}}class r{constructor(e){this.serverInterface=e,this.paramNames=["id","institution"]}async get(){return(await this.serverInterface.sendGetRequest("performer")).map(e=>new n(e[0],e[1]))}async post(e){const t={[this.paramNames[1]]:e};await this.serverInterface.sendPostRequest("performer",t)}async put(e,t){const s={[this.paramNames[0]]:e};Object.assign(s,null!==t&&{[this.paramNames[1]]:t}),await this.serverInterface.sendPutRequest("performer",s)}async delete(e){await this.serverInterface.sendDeleteRequest("performer","id="+e)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class n{constructor(e,t,s,n,r,a){this.id=e,this.key=t,this.shortDescription=s,this.longDescription=n,this.institution=r,this.configuration=a}}class r{constructor(e){this.serverInterface=e,this.paramNames=["id","key","short_description","long_description","institution","configuration"]}async get(){return(await this.serverInterface.sendGetRequest("vehicle")).map(e=>new n(e[0],e[1],e[2],e[3],e[4],e[5]))}async post(e,t,s,n,r){const a={[this.paramNames[1]]:e,[this.paramNames[2]]:t,[this.paramNames[3]]:s,[this.paramNames[4]]:n,[this.paramNames[5]]:r};await this.serverInterface.sendPostRequest("vehicle",a)}async put(e,t,s,n,r,a){const o={[this.paramNames[0]]:e};Object.assign(o,null!==t&&{[this.paramNames[1]]:t},null!==s&&{[this.paramNames[2]]:s},null!==n&&{[this.paramNames[3]]:n},null!==r&&{[this.paramNames[4]]:r},null!==a&&{[this.paramNames[5]]:a}),await this.serverInterface.sendPutRequest("vehicle",o)}async delete(e){await this.serverInterface.sendDeleteRequest("vehicle","id="+e)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class n{constructor(e,t,s,n){this.id=e,this.key=t,this.shortDescription=s,this.longDescription=n}}class r{constructor(e){this.serverInterface=e,this.paramNames=["id","key","short_description","long_description"]}async get(){return(await this.serverInterface.sendGetRequest("pose_source")).map(e=>new n(e[0],e[1],e[2],e[3]))}async post(e,t,s){const n={[this.paramNames[1]]:e,[this.paramNames[2]]:t,[this.paramNames[3]]:s};await this.serverInterface.sendPostRequest("pose_source",n)}async put(e,t,s,n){const r={[this.paramNames[0]]:e};Object.assign(r,null!==t&&{[this.paramNames[1]]:t},null!==s&&{[this.paramNames[2]]:s},null!==n&&{[this.paramNames[3]]:n}),await this.serverInterface.sendPutRequest("pose_source",r)}async delete(e){await this.serverInterface.sendDeleteRequest("pose_source","id="+e)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(){const e=document.getElementById("ros-config-template");this.element=document.importNode(e.content,!0);const t=this.element.getElementById("ros-url"),s=JSON.parse(localStorage.getItem("fttRosData"));t.value=s?s.url:`ws://${location.hostname}:9090`,t.addEventListener("input",this.dataChangedHandler.bind(this)),this.element.querySelector("form button:first-of-type").addEventListener("click",this.updateDataBtnHandler.bind(this)),this.element.querySelector("form button:last-of-type").addEventListener("click",this.resetDataBtnHandler.bind(this))}dataChangedHandler(){this.element.querySelector("form button").disabled=!1}async updateDataBtnHandler(e){e.preventDefault();let t={};t.url=document.getElementById("ros-url").value,localStorage.setItem("fttRosData",JSON.stringify(t)),this.element.querySelector("form button").disabled=!0}async resetDataBtnHandler(e){e.preventDefault(),document.getElementById("ros-url").value=`ws://${location.hostname}:9090`,localStorage.removeItem("fttRosData"),this.element.querySelector("form button").disabled=!0}}},,function(e,t,s){"use strict";s.r(t);var n=s(3),r=s(0),a=s(4),o=s(2),i=s(6),c=s(5);function l(e,t){return new Promise((s,n)=>{const r=new ROSLIB.Service({ros:e,name:"/rosapi/get_param",serviceType:"rosapi/GetParam"}),a=new ROSLIB.ServiceRequest({name:t,default:""});r.callService(a,(function(e){console.log(`Got ROS parameter -> ${t}: ${e.value}`),s(e.value)}),(function(e){n(new Error(e))}))})}class d{constructor(e,t="/ftt_ros/params/"){this.ros=e,this.paramNames=["name","value"],this.fttRosParamNamePrefix=t,this.fttRosParamNames=null}async getFttRosParamNames(){if(!this.fttRosParamNames){const t=await(e=this.ros,new Promise((t,s)=>{const n=new ROSLIB.Service({ros:e,name:"/rosapi/get_param_names",serviceType:"rosapi/GetParamNames"}),r=new ROSLIB.ServiceRequest;n.callService(r,(function(e){console.log("Retrieved all ROS parameter names."),t(e.names)}),(function(e){s(new Error(e))}))}));this.fttRosParamNames=t.filter(e=>e.includes(this.fttRosParamNamePrefix))}var e}async get(){await this.getFttRosParamNames();const e=[];for(const t of this.fttRosParamNames)e.push({name:t.split("/").pop(),value:await l(this.ros,t)});return e}async put(e,t){await this.getFttRosParamNames();const s=this.fttRosParamNames.find(t=>t.includes(e));await function(e,t,s){return new Promise((n,r)=>{const a=new ROSLIB.Service({ros:e,name:"/rosapi/set_param",serviceType:"rosapi/SetParam"}),o=new ROSLIB.ServiceRequest({name:t,value:s});a.callService(o,(function(e){console.log(`Set ROS parameter -> ${t}: ${s}`),n(e.value)}),(function(e){r(new Error(e))}))})}(this.ros,s,t)}}class m extends d{constructor(e,t="/ftt_ros/topics/"){super(e,t),this.supportedTopics={robot_mode:"industrial_msgs/RobotMode",gps_fix:"sensor_msgs/NavSatFix",local_pose:"geometry_msgs/Pose",map:"nav_msgs/OccupancyGrid",image:"sensor_msgs/Image",image_compressed:"sensor_msgs/CompressedImage"}}async getOptions(e){const t=this.supportedTopics[e];return(await function(e,t){return new Promise((s,n)=>{const r=new ROSLIB.Service({ros:e,name:"/rosapi/topics_for_type",serviceType:"rosapi/TopicsForType"}),a=new ROSLIB.ServiceRequest({type:t});r.callService(a,(function(e){console.log("Got all ROS topics of type "+t),s(e.topics)}),(function(e){n(new Error(e))}))})}(this.ros,t)).map(e=>'"'+e+'"')}}var u=s(1),h=s(7);class p{constructor(e){const t=[document.getElementById("performer"),document.getElementById("personnel"),document.getElementById("pose-source"),document.getElementById("vehicle"),document.getElementById("parameters"),document.getElementById("topics")],s=[document.getElementById("performer-table-body").lastElementChild,document.getElementById("personnel-table-body").lastElementChild,document.getElementById("pose-source-table-body").lastElementChild,document.getElementById("vehicle-table-body").lastElementChild];this.rosConnectIcon=document.getElementById("ros-connect-icon");const n=document.getElementById("parameters-table-body").lastElementChild,r=document.getElementById("topics-table-body").lastElementChild;this.forceRosConnect=!1,this.ros=new ROSLIB.Ros,this.ros_server_adr=`ws://${location.hostname}:9090`,this.dataInterfaces=[new a.a(e),new o.b(e),new i.a(e),new c.a(e),new d(this.ros,"/ftt_ros/params/"),new m(this.ros,"/ftt_ros/topics/")];for(let e=0;e<t.length;e++)t[e].addEventListener("click",this.titleClickHandler.bind(this,this.dataInterfaces[e]));for(let e=0;e<s.length;e++)s[e].addEventListener("click",this.inputNewEntryClickHandler.bind(this,this.dataInterfaces[e]));for(let e=0;e<s.length;e++)s[e].addEventListener("focusout",this.newEntryDefocusHandler.bind(this));n.addEventListener("click",this.saveRosParams.bind(this)),r.addEventListener("click",this.saveRosParams.bind(this)),this.rosConnectIcon.addEventListener("click",this.rosConnectIconClickHandler.bind(this)),this.ros.on("error",this.rosErrorHandler.bind(this)),this.ros.on("connection",this.rosConnectionHandler.bind(this)),this.ros.on("close",this.rosCloseHandler.bind(this)),this.rosConnect()}static resetNewEntryRow(e){for(;e.children.length>1;)e.lastElementChild.remove();e.style.gridTemplateColumns="none"}insertTableIcons(e,t){Array.from(e.children).forEach(e=>{const s=[],n=[];"function"==typeof t.put&&(s.push("edit"),n.push(this.editEntryClickHandler.bind(this,t))),"function"==typeof t.delete&&(s.push("clear"),n.push(this.clearEntryClickHandler.bind(this,t)));const a=r.a.createMaterialIconsContainer("div",s,n);e.appendChild(a)})}async updateTable(e,t){const s=await e.get(),n=t.lastElementChild;r.a.populateTable(t,s.map(e=>Object.values(e))),this.insertTableIcons(t,e),t.appendChild(n)}async titleClickHandler(e,t){const s=t.target.closest("div"),n=s.nextElementSibling;if("block"==n.style.display)s.style.borderRadius="10px",s.lastElementChild.textContent="add",n.style.display="none";else{const t=n.querySelector("tbody");try{await this.updateTable(e,t),s.style.borderRadius="10px 10px 0 0",s.lastElementChild.textContent="remove",n.style.display="block"}catch(e){alert(e.message)}}}async putEntryClickHandler(e,t){const s=t.target.closest("tr");let n=[s.children[0].textContent],r=!1;for(let t=1;t<e.paramNames.length;t++){const e=s.children[t].value;e||(s.children[t].required=!0,r=!0),n.push(e)}if(!r)try{await e.put(...n),await this.updateTable(e,s.closest("tbody"))}catch(e){alert(e.message)}}async postEntryClickHandler(e,t){const s=t.target.closest("tr");let n=[],r=!1;for(let t=1;t<e.paramNames.length;t++){const e=s.children[t].value||s.children[t].placeholder;e||(s.children[t].required=!0,r=!0),n.push(e)}if(!r)try{await e.post(...n),await this.updateTable(e,s.closest("tbody")),p.resetNewEntryRow(s)}catch(e){alert(e.message)}}async editEntryDefocusHandler(e,t){const s=t.target.closest("tr");if(!t.relatedTarget||t.relatedTarget.closest("tr")!=s)try{await this.updateTable(e,s.closest("tbody"))}catch(e){alert(e.message)}}async editEntryClickHandler(e,t){const s=t.target.closest("tr");s.addEventListener("focusout",this.editEntryDefocusHandler.bind(this,e));for(let t=1;t<e.paramNames.length;t++){const n=document.createElement("input");if(n.type="text",n.className="new-entry-input",n.value=s.children[t].textContent,s.children[t].replaceWith(n),e instanceof m){let t=document.getElementById("topics-list");t||(t=document.createElement("datalist"),t.id="topics-list",n.insertAdjacentElement("afterend",t));const a=await e.getOptions(s.children[0].textContent);r.a.populateSelect(t,a),r.a.removeFirstEmptyOption(t),n.setAttribute("list","topics-list")}}const n=r.a.createMaterialIconsContainer("button",["done"]);s.lastElementChild.replaceWith(n),n.addEventListener("click",this.putEntryClickHandler.bind(this,e)),s.children[1].focus()}async clearEntryClickHandler(e,t){const s=t.target.closest("tr"),n=s.firstElementChild.textContent;try{await e.delete(n),await this.updateTable(e,s.closest("tbody"))}catch(e){alert(e.message)}}inputNewEntryClickHandler(e,t){const s=t.target.closest("tr");if(s.style.gridTemplateColumns){s.style.removeProperty("grid-template-columns");for(let t=1;t<e.paramNames.length;t++){const n=document.createElement("input");n.type="text",n.className="new-entry-input","long_description"!=e.paramNames[t]&&"configuration"!=e.paramNames[t]||(n.placeholder="--"),s.appendChild(n)}const t=r.a.createMaterialIconsContainer("button",["done"]);s.appendChild(t),t.addEventListener("click",this.postEntryClickHandler.bind(this,e)),s.children[1].focus()}}newEntryDefocusHandler(e){const t=e.target.closest("tr");e.relatedTarget&&e.relatedTarget.closest("tr")==t||p.resetNewEntryRow(t)}async saveRosParams(){const e=new ROSLIB.Service({ros:this.ros,name:"/save_ftt_params",serviceType:"std_srvs/Trigger"}),t=new ROSLIB.ServiceRequest;e.callService(t,(function(e){e.success?alert("Request succeeded! "+e.message):alert("Request failed! "+e.message)}),(function(e){alert(e)}))}rosConnectIconClickHandler(){const e=new h.a;new u.a(e,"Your browser doesn't support this feature! - Please change to a more modern one.",()=>{this.forceRosConnect=!0,this.rosConnect()}).show()}rosConnect(){this.ros.connect(this.ros_server_adr)}rosErrorHandler(){console.log("Error connecting to ROS"),this.forceRosConnect&&(alert("Error connecting to ROS"),this.forceRosConnect=!1)}rosConnectionHandler(){this.rosConnectIcon.classList.remove("disconnected"),this.rosConnectIcon.classList.add("connected"),this.rosConnectIcon.textContent="sensors",console.log("Connection to ROS established.")}rosCloseHandler(){this.rosConnectIcon.classList.remove("connected"),this.rosConnectIcon.classList.add("disconnected"),this.rosConnectIcon.textContent="sensors_off",console.log("Connection to ROS closed.");const e=document.getElementById("parameters"),t=document.getElementById("topics");"block"==e.nextElementSibling.style.display&&e.click(),"block"==t.nextElementSibling.style.display&&t.click()}}(class{static init(){this.serverInterface=new n.a,this.configFrame=new p(this.serverInterface)}}).init()}]);
//# sourceMappingURL=config.js.map